#!/usr/bin/env python3
# -*- coding: utf-8 -*-

# Lessons

## User Specified Lessons

- Include info useful for debugging in the program output.
- Read the file before you try to edit it.
- Due to Cursor's limit, when you use `git` and `gh` and need to submit a multiline commit message, first write the message in a file, and then use `git commit -F <filename>` or similar command to commit. And then remove the file. Include "[Cursor] " in the commit message and PR title.

## Cursor learned

- For search results, ensure proper handling of different character encodings (UTF-8) for international queries
- Add debug information to stderr while keeping the main output clean in stdout for better pipeline integration
- When using seaborn styles in matplotlib, use 'seaborn-v0_8' instead of 'seaborn' as the style name due to recent seaborn version changes
- Use `chatgpt-4o-latest` as the model name for OpenAI. It is the latest GPT model and has vision capabilities as well. `o1` is the most advanced and expensive model from OpenAI. Use it when you need to do reasoning, planning, or get blocked.
- Use `claude-3.7-sonnet` as the model name for Claude. It is the latest Claude model and has vision capabilities as well.
- When encountering unexpected execution behavior (like hangs or wrong logic) with build tools (e.g., `./gradlew run`), double-check the build configuration file (e.g., `build.gradle`) for the correct entry point (`mainClass`) setting, as temporary changes or misconfigurations can lead to running unintended code.
- o3 and o4-mini are the most advanced models from OpenAI. Avoid using them for coding for now due to severe hallucinations. 
- æµ‹è¯•é©±åŠ¨å¼€å‘ï¼ˆTDDï¼‰è¿‡ç¨‹ä¸­ï¼Œå…ˆåˆ›å»ºå¤±è´¥çš„æµ‹è¯•ï¼Œç„¶åå®ç°æœ€å°çš„ä»£ç ä½¿æµ‹è¯•é€šè¿‡ï¼Œæœ€åé‡æ„ä»£ç æ”¹è¿›è®¾è®¡ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿ä»£ç çš„å¯é æ€§å’Œè´¨é‡ã€‚
- åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä½¿ç”¨çº¯æ•°æ®ç»“æ„ï¼ˆå¦‚dataclassï¼‰ä½œä¸ºæ¶ˆæ¯ç±»å‹å¯ä»¥ç®€åŒ–åºåˆ—åŒ–å’Œè·¨è¿›ç¨‹é€šä¿¡ã€‚
- åœ¨å®ç°ç›‘æ§å’Œæ¢å¤æœºåˆ¶æ—¶ï¼Œè¦æ³¨æ„é¿å…è¯¯è§¦å‘ï¼ˆå‡é˜³æ€§ï¼‰å’Œä¿æŒé«˜å“åº”æ€§ã€‚
- å¯¹äºå¤æ‚çš„å¼‚æ­¥æµ‹è¯•ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨åŒæ­¥æ¨¡æ‹Ÿï¼ˆmockï¼‰æ›¿ä»£ï¼Œç®€åŒ–æµ‹è¯•é€»è¾‘å¹¶æé«˜æµ‹è¯•çš„å¯é æ€§ã€‚
- åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¤„ç†çŠ¶æ€åŒæ­¥æ—¶ï¼Œåº”ä½¿ç”¨æ·±æ‹·è´è€Œéæµ…æ‹·è´ï¼Œé¿å…å¼•ç”¨é—®é¢˜å¯¼è‡´çš„æ„å¤–çŠ¶æ€æ›´æ”¹ã€‚
- äº‹ä»¶å¤„ç†æœºåˆ¶ï¼ˆevent handlingï¼‰æ˜¯å®ç°æ¾è€¦åˆç»„ä»¶é—´é€šä¿¡çš„æœ‰æ•ˆæ–¹å¼ï¼Œç‰¹åˆ«é€‚ç”¨äºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„çŠ¶æ€å˜åŒ–é€šçŸ¥ã€‚
- åœ¨é«˜å»¶è¿Ÿç½‘ç»œç¯å¢ƒä¸‹ï¼Œä½¿ç”¨æ‰¹å¤„ç†å’Œè‡ªé€‚åº”å¿ƒè·³å¯æ˜¾è‘—æé«˜ç³»ç»Ÿæ€§èƒ½ï¼Œæ‰¹å¤„ç†å¯å‡å°‘30-40%çš„å»¶è¿Ÿã€‚
- æ€§èƒ½æµ‹è¯•åº”è¦†ç›–ä¸åŒç½‘ç»œæ¡ä»¶ï¼ˆå»¶è¿Ÿã€æŠ–åŠ¨ã€ä¸¢åŒ…ï¼‰ï¼Œä»¥å…¨é¢äº†è§£ç³»ç»Ÿåœ¨å„ç§ç¯å¢ƒä¸‹çš„è¡¨ç°ã€‚
- ä½¿ç”¨é…ç½®é©±åŠ¨å¼€å‘ï¼Œå¯ä»¥è½»æ¾è°ƒæ•´å’Œä¼˜åŒ–ç³»ç»Ÿè¡Œä¸ºï¼Œæ— éœ€ä¿®æ”¹ä»£ç ã€‚
- åœ¨è®¾è®¡æ— çŠ¶æ€æœåŠ¡æ—¶åº”é‡‡ç”¨JWTç­‰è®¤è¯æ–¹å¼ï¼Œå¯ç¡®ä¿æœåŠ¡å®ä¾‹ä¹‹é—´æ— éœ€å…±äº«ä¼šè¯çŠ¶æ€ï¼Œæé«˜ç³»ç»Ÿçš„å¯ä¼¸ç¼©æ€§å’Œå¯é æ€§ã€‚
- æ¶ˆæ¯é˜Ÿåˆ—æ˜¯å¤„ç†ç³»ç»Ÿç»„ä»¶é—´é€šä¿¡çš„å…³é”®æ¨¡å¼ï¼Œå°¤å…¶æ˜¯åœ¨é¢å¯¹ç½‘ç»œä¸ç¨³å®šæˆ–ç»„ä»¶ä¸´æ—¶ä¸å¯ç”¨æ—¶ï¼Œèƒ½æä¾›å¯é çš„æ¶ˆæ¯ä¼ é€’ä¿è¯ã€‚
- åœ¨å¤„ç†WebSocketé•¿è¿æ¥æ—¶ï¼Œåº”å®ç°å¿ƒè·³æœºåˆ¶æ£€æµ‹è¿æ¥çŠ¶æ€ï¼Œå¹¶é‡‡ç”¨æŒ‡æ•°é€€é¿ç®—æ³•è¿›è¡Œé‡è¿ï¼Œæé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚
- JWTè®¤è¯æœºåˆ¶åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ç‰¹åˆ«æœ‰ç”¨ï¼Œé€šè¿‡å°†ä»¤ç‰Œè´Ÿè½½ä¸­åŒ…å«å¿…è¦çš„ç”¨æˆ·å’Œä¼šè¯ä¿¡æ¯ï¼Œå‡å°‘äº†å¯¹ä¸­å¿ƒåŒ–çŠ¶æ€å­˜å‚¨çš„ä¾èµ–ã€‚
- åœ¨å®ç°WebSocketè¿æ¥ç®¡ç†å™¨æ—¶ï¼Œä¸ºä¸åŒç›®æ ‡ï¼ˆä¼šè¯ã€ç”¨æˆ·ã€è®¾å¤‡ï¼‰æä¾›ä¸“é—¨çš„æ¶ˆæ¯å‘é€æ–¹æ³•å¯ä»¥ç®€åŒ–ä¸Šå±‚åº”ç”¨é€»è¾‘ï¼Œæé«˜ä»£ç å¯è¯»æ€§ã€‚
- è®¾è®¡æ¨¡å¼ä¸­çš„"è§‚å¯Ÿè€…æ¨¡å¼"éå¸¸é€‚åˆå®ç°å¼‚æ­¥æ¶ˆæ¯è·¯ç”±ç³»ç»Ÿï¼Œè·¯ç”±å™¨å……å½“è§‚å¯Ÿè€…é€šçŸ¥ä¸­å¿ƒï¼Œå„ä¸ªæ¶ˆæ¯å¤„ç†å™¨ä½œä¸ºè§‚å¯Ÿè€…è®¢é˜…ç‰¹å®šç±»å‹çš„æ¶ˆæ¯ã€‚
- ä½¿ç”¨asyncio.Queueæ„å»ºå¼‚æ­¥æ¶ˆæ¯é˜Ÿåˆ—æ˜¯å¤„ç†å¹¶å‘WebSocketè¿æ¥çš„é«˜æ•ˆæ–¹æ³•ï¼Œå¯ä»¥é¿å…é˜»å¡ä¸»äº‹ä»¶å¾ªç¯ï¼ŒåŒæ—¶ç¡®ä¿æ¶ˆæ¯æŒ‰é¡ºåºå¤„ç†ã€‚
- ä¸ºJWTè®¤è¯ç³»ç»Ÿå®ç°è®¿é—®ä»¤ç‰Œ/åˆ·æ–°ä»¤ç‰Œåˆ†ç¦»æœºåˆ¶å¯ä»¥æ˜¾è‘—æé«˜å®‰å…¨æ€§ï¼Œå…è®¸çŸ­æœŸè®¿é—®ä»¤ç‰Œé™ä½é£é™©ï¼ŒåŒæ—¶é•¿æœŸåˆ·æ–°ä»¤ç‰Œå‡å°‘ç”¨æˆ·é‡æ–°è®¤è¯çš„é¢‘ç‡ã€‚
- åœ¨è®¾è®¡åˆ†å¸ƒå¼æ¶ˆæ¯ç³»ç»Ÿæ—¶ï¼Œæ¶ˆæ¯å…ƒæ•°æ®ï¼ˆå¦‚æ¶ˆæ¯IDã€æ—¶é—´æˆ³ã€å…³è”IDï¼‰ä¸æ¶ˆæ¯å†…å®¹åŒç­‰é‡è¦ï¼Œå®ƒä»¬ç¡®ä¿æ¶ˆæ¯å¯ä»¥è¢«æ­£ç¡®è·¯ç”±ã€å»é‡å’Œè¿½è¸ªã€‚
- åœ¨è¿›è¡ŒWebSocketå’ŒREST APIæµ‹è¯•æ—¶ï¼Œä½¿ç”¨pytest-asyncioå’Œå¼‚æ­¥å®¢æˆ·ç«¯æ¨¡æ‹Ÿèƒ½æ˜¾è‘—ç®€åŒ–æµ‹è¯•ä»£ç ï¼Œç‰¹åˆ«æ˜¯å¯¹äºå¹¶å‘åœºæ™¯çš„æµ‹è¯•ã€‚
- ä½¿ç”¨åŠè‡ªåŠ¨åŒ–æ¶æ„å†³ç­–è®°å½•(ADR)å·¥ä½œæµï¼Œå¯ä»¥æ•è·å…³é”®æŠ€æœ¯å†³ç­–çš„èƒŒæ™¯ã€é€‰æ‹©å’Œå½±å“ï¼Œæœ‰æ•ˆæå‡é¡¹ç›®çš„é•¿æœŸå¯ç»´æŠ¤æ€§å’ŒçŸ¥è¯†ä¼ æ‰¿ã€‚
- å°†ADRé›†æˆåˆ°Plan-Executeå¾ªç¯ä¸­ï¼Œå¯ä»¥ç¡®ä¿æ‰€æœ‰é‡è¦å†³ç­–çš„å¯è¿½æº¯æ€§ï¼Œå¸®åŠ©æ–°å›¢é˜Ÿæˆå‘˜å¿«é€Ÿäº†è§£å†å²å†³ç­–åŸå› ã€‚

# Multi-Agent Scratchpad

## Background and Motivation

Oppie Remote Cursor Control Mesh (RCCM)æ˜¯ä¸€ä¸ªå…è®¸ç”¨æˆ·ä»æ‰‹æœºå¯åŠ¨å¹¶ç›‘æ§Cursorä»»åŠ¡çš„ç³»ç»Ÿã€‚è¯¥ç³»ç»Ÿéœ€è¦èƒ½å¤Ÿè‡ªåŠ¨æ¢å¤25å·¥å…·è°ƒç”¨é™åˆ¶å’Œç¼ºå°‘Template Aç­‰é—®é¢˜ï¼Œæ— éœ€äººå·¥å¹²é¢„ã€‚

## Key Challenges and Analysis

- ç¡®ä¿ç³»ç»Ÿåœ¨Cursorè¾¾åˆ°25å·¥å…·è°ƒç”¨é™åˆ¶æ—¶èƒ½è‡ªåŠ¨æ¢å¤
- ç›‘æµ‹Assistant Bubbleç¼ºå°‘Template Açš„æƒ…å†µå¹¶æ¢å¤
- æ”¯æŒä»ç§»åŠ¨è®¾å¤‡è¿œç¨‹è§¦å‘å’Œç›‘æ§ä»»åŠ¡
- ç»´æŒP95æ¨é€å»¶è¿Ÿ<500msçš„æ€§èƒ½è¦æ±‚
- å®ç°â‰¥40%çš„æ— äººå€¼å®ˆæˆåŠŸç‡
- åœ¨å¤šèŠ‚ç‚¹ç¯å¢ƒä¸­ä¿æŒçŠ¶æ€ä¸€è‡´æ€§å’Œè§£å†³å†²çª
- è®¾è®¡æ¾æ•£è€¦åˆçš„ç»„ä»¶ä»¥ä¾¿äºæµ‹è¯•å’Œæ‰©å±•
- åœ¨é«˜å»¶è¿Ÿå’Œé«˜ä¸¢åŒ…ç½‘ç»œç¯å¢ƒä¸‹ä¿æŒç³»ç»Ÿçš„å¯é æ€§å’Œæ€§èƒ½
- è®¾è®¡å®‰å…¨çš„Cloud RelayæœåŠ¡ï¼Œæ”¯æŒç§»åŠ¨PWAå’Œæœ¬åœ°Sidecar Daemonä¹‹é—´çš„é€šä¿¡
- ç¡®ä¿JWTè®¤è¯ç³»ç»Ÿçš„å®‰å…¨å¯é ï¼Œæä¾›é€‚å½“çš„ä»¤ç‰Œè¿‡æœŸå’Œåˆ·æ–°æœºåˆ¶
- å®ç°é«˜æ•ˆçš„WebSocketè¿æ¥ç®¡ç†ï¼Œæ”¯æŒæ–­çº¿é‡è¿å’Œæ¶ˆæ¯å¯é ä¼ é€’
- è®°å½•å…³é”®æ¶æ„å†³ç­–ï¼Œç¡®ä¿é‡è¦æŠ€æœ¯é€‰æ‹©çš„å¯è¿½æº¯æ€§ï¼Œæ–¹ä¾¿åæœŸç»´æŠ¤å’ŒçŸ¥è¯†ä¼ æ‰¿
- åˆ›å»ºVS Codeæ‰©å±•ï¼Œæä¾›ç›´è§‚çš„ç”¨æˆ·ç•Œé¢æ¥è§¦å‘å’Œç›‘æ§Plan-Executeå¾ªç¯
- å®ç°Vector Storeç»„ä»¶ï¼Œç”¨äºé«˜æ•ˆä»£ç ç´¢å¼•å’Œè¯­ä¹‰æœç´¢ï¼ˆMVP å®Œæˆï¼‰

## RCCMæµ‹è¯•ç­–ç•¥

### æµ‹è¯•å±‚æ¬¡ç»“æ„
- **å•å…ƒæµ‹è¯•**ï¼šè¦†ç›–CursorCoreå’Œå„ç»„ä»¶çš„çŠ¶æ€è½¬æ¢å’Œè¾¹ç•Œæ¡ä»¶
- **æœåŠ¡çº§é›†æˆæµ‹è¯•**ï¼šéªŒè¯ç»„ä»¶é—´åä½œï¼Œç‰¹åˆ«æ˜¯MeshAdapterèŠ‚ç‚¹é—´çš„åŒæ­¥
- **ç«¯åˆ°ç«¯æµ‹è¯•**ï¼šæ¨¡æ‹Ÿç½‘ç»œå’Œå·¥å…·é™åˆ¶æ¡ä»¶ä¸‹çš„å®Œæ•´æµç¨‹æµ‹è¯•
- **æ€§èƒ½æµ‹è¯•**ï¼šåœ¨ä¸åŒç½‘ç»œæ¡ä»¶ä¸‹è¯„ä¼°ç³»ç»Ÿæ€§èƒ½å’Œä¼˜åŒ–æ•ˆæœ

### å…³é”®æµ‹è¯•åœºæ™¯
1. **å·¥å…·è°ƒç”¨é™åˆ¶**ï¼šéªŒè¯ç³»ç»Ÿåœ¨è¾¾åˆ°25å·¥å…·è°ƒç”¨é™åˆ¶æ—¶èƒ½å¦æ­£ç¡®æ£€æµ‹å¹¶æ¢å¤
2. **æ¨¡æ¿ç¼ºå¤±å¤„ç†**ï¼šç¡®ä¿ç³»ç»Ÿèƒ½æ£€æµ‹åˆ°ç¼ºå°‘Template Aå¹¶é‡‡å–é€‚å½“è¡ŒåŠ¨
3. **ç½‘ç»œæ•…éšœæ¢å¤**ï¼šæµ‹è¯•åœ¨ç½‘ç»œä¸­æ–­åçš„é‡è¿å’ŒçŠ¶æ€åŒæ­¥èƒ½åŠ›
4. **æ€§èƒ½æŒ‡æ ‡è¾¾æˆ**ï¼šéªŒè¯ç³»ç»Ÿèƒ½å¦æ»¡è¶³P95æ¨é€å»¶è¿Ÿ<500msçš„è¦æ±‚
5. **WebSocketè¿æ¥**ï¼šéªŒè¯PWAä¸Cloud Relayï¼Œä»¥åŠSidecarä¸Cloud Relayä¹‹é—´çš„WebSocketé€šä¿¡
6. **è®¤è¯æµç¨‹**ï¼šæµ‹è¯•JWTè®¤è¯æµç¨‹ï¼ŒåŒ…æ‹¬ä»¤ç‰Œåˆ›å»ºã€éªŒè¯å’Œåˆ·æ–°
7. **æ¶ˆæ¯è·¯ç”±**ï¼šéªŒè¯æ¶ˆæ¯èƒ½å¦æ­£ç¡®è·¯ç”±åˆ°ç›®æ ‡è®¾å¤‡/ä¼šè¯

### æµ‹è¯•å·¥å…·å’Œæ¡†æ¶
- ToolProxyï¼šåŒ…è£…æ‰€æœ‰MCPè°ƒç”¨ï¼Œè®¡æ•°å¹¶å¯é¢„è®¾"é…é¢è€—å°½"å“åº”
- ç¡®å®šæ€§äº‹ä»¶æ€»çº¿ï¼šç”¨äºå¯é‡å¤çš„é›†æˆæµ‹è¯•
- æ¨¡æ‹Ÿå™¨/å‡å¯¹è±¡ï¼šæ¨¡æ‹Ÿç½‘ç»œå±‚å’ŒMCPå·¥å…·è°ƒç”¨
- NetworkEmulatorï¼šæ¨¡æ‹Ÿä¸åŒç½‘ç»œæ¡ä»¶ï¼ˆå»¶è¿Ÿã€æŠ–åŠ¨å’Œä¸¢åŒ…ï¼‰
- MetricsCollectorï¼šæ”¶é›†å’Œå¯¼å‡ºæ€§èƒ½æŒ‡æ ‡
- WebSocketTestClientï¼šæ¨¡æ‹ŸPWAå’ŒSidecarï¼Œæµ‹è¯•Cloud Relayçš„WebSocketè¿æ¥å’Œæ¶ˆæ¯å¤„ç†
- JWTTestClientï¼šæµ‹è¯•è®¤è¯åŠŸèƒ½

### æµ‹è¯•çŸ©é˜µ

| ç»„ä»¶ | æµ‹è¯•ç±»å‹ | æµ‹è¯•åœºæ™¯ | æµ‹è¯•æ–‡ä»¶ | çŠ¶æ€ |
|------|---------|---------|---------|------|
| CursorCore | å•å…ƒ | æ¿€æ´»å’ŒIPCæœåŠ¡å™¨åˆ›å»º | tests/unit/test_cursor_core.py | ç»¿è‰²ï¼ˆå·²å®ç°ï¼‰ |
| CursorCore | å•å…ƒ | æ¶ˆæ¯å¤„ç†ï¼ˆrunPlan, chat, recoverï¼‰| tests/unit/test_cursor_core.py | ç»¿è‰²ï¼ˆå·²å®ç°ï¼‰ |
| CursorCore | å•å…ƒ | execute_planè°ƒç”¨PocketFlow | tests/unit/test_cursor_core.py | ç»¿è‰²ï¼ˆå·²å®ç°ï¼‰ |
| CursorCore | å•å…ƒ | äº‹ä»¶å‘é€ï¼ˆwebview, sidecarï¼‰| tests/unit/test_cursor_core.py | ç»¿è‰²ï¼ˆå·²å®ç°ï¼‰ |
| CursorCore | å•å…ƒ | 25å·¥å…·è°ƒç”¨é™åˆ¶å¤„ç† | tests/unit/test_cursor_core.py | ç»¿è‰²ï¼ˆå·²å®ç°ï¼‰ |
| ToolProxy | å•å…ƒ | å·¥å…·è°ƒç”¨è®¡æ•° | tests/unit/test_tool_proxy.py | ç»¿è‰²ï¼ˆå·²å®ç°ï¼‰ |
| ToolProxy | å•å…ƒ | è°ƒç”¨é™åˆ¶å¼ºåˆ¶æ‰§è¡Œ | tests/unit/test_tool_proxy.py | ç»¿è‰²ï¼ˆå·²å®ç°ï¼‰ |
| ToolProxy | å•å…ƒ | é¢„è®¾é…é¢è€—å°½çŠ¶æ€ | tests/unit/test_tool_proxy.py | ç»¿è‰²ï¼ˆå·²å®ç°ï¼‰ |
| ToolProxy | å•å…ƒ | å¤šä»£ç†å…±äº«è®¡æ•° | tests/unit/test_tool_proxy.py | ç»¿è‰²ï¼ˆå·²å®ç°ï¼‰ |
| ToolProxy | å•å…ƒ | å¤šèŠ‚ç‚¹è®¡æ•°åŒæ­¥ | tests/integration/test_mesh_adapter.py | ç»¿è‰²ï¼ˆå·²å®ç°ï¼‰ |
| MeshAdapter | é›†æˆ | æ¶ˆæ¯ä¼ æ’­ | tests/integration/test_mesh_adapter.py | ç»¿è‰²ï¼ˆå·²å®ç°ï¼‰ |
| MeshAdapter | é›†æˆ | èŠ‚ç‚¹æ–­å¼€é‡è¿ | tests/integration/test_mesh_adapter.py | ç»¿è‰²ï¼ˆå·²å®ç°ï¼‰ |
| MeshAdapter | é›†æˆ | çŠ¶æ€åŒæ­¥ | tests/integration/test_mesh_adapter.py | ç»¿è‰²ï¼ˆå·²å®ç°ï¼‰ |
| MeshAdapter | é›†æˆ | å†²çªè§£å†³ | tests/integration/test_mesh_adapter.py | ç»¿è‰²ï¼ˆå·²å®ç°ï¼‰ |
| MeshAdapter | é›†æˆ | å¿ƒè·³æœºåˆ¶ | tests/integration/test_mesh_adapter.py | ç»¿è‰²ï¼ˆå·²å®ç°ï¼‰ |
| DevLoopWatcher | å•å…ƒ | äº‹ä»¶å¤„ç†æœºåˆ¶ | tests/e2e/test_recovery_mechanism.py | ç»¿è‰²ï¼ˆå·²å®ç°ï¼‰ |
| æ¢å¤æœºåˆ¶ | E2E | 25å·¥å…·è°ƒç”¨é™åˆ¶æ¢å¤ | tests/e2e/test_recovery_mechanism.py | ç»¿è‰²ï¼ˆå·²å®ç°ï¼‰ |
| æ¢å¤æœºåˆ¶ | E2E | ç¼ºå°‘Template Aæ¢å¤ | tests/e2e/test_recovery_mechanism.py | ç»¿è‰²ï¼ˆå·²å®ç°ï¼‰ |
| æ¢å¤æœºåˆ¶ | E2E | ç«¯åˆ°ç«¯æ¢å¤å·¥ä½œæµ | tests/e2e/test_recovery_mechanism.py | ç»¿è‰²ï¼ˆå·²å®ç°ï¼‰ |
| æ¢å¤æœºåˆ¶ | E2E | æ¢å¤æ€§èƒ½ï¼ˆ<250msï¼‰ | tests/e2e/test_recovery_mechanism.py | ç»¿è‰²ï¼ˆå·²å®ç°ï¼‰ |
| æ¢å¤æœºåˆ¶ | E2E | å‡é˜³æ€§ç‡ï¼ˆ<1%ï¼‰ | tests/e2e/test_recovery_mechanism.py | ç»¿è‰²ï¼ˆå·²å®ç°ï¼‰ |
| MeshAdapter | æ€§èƒ½ | åŸºçº¿æ€§èƒ½ï¼ˆæ— å»¶è¿Ÿï¼‰ | tests/performance/test_network_conditions.py | ç»¿è‰²ï¼ˆå·²å®ç°ï¼‰ |
| MeshAdapter | æ€§èƒ½ | æ‰¹å¤„ç†ä¼˜åŒ– | tests/performance/test_network_conditions.py | ç»¿è‰²ï¼ˆå·²å®ç°ï¼‰ |
| MeshAdapter | æ€§èƒ½ | é«˜å»¶è¿Ÿç¯å¢ƒ | tests/performance/test_network_conditions.py | ç»¿è‰²ï¼ˆå·²å®ç°ï¼‰ |
| MeshAdapter | æ€§èƒ½ | é«˜ä¸¢åŒ…ç¯å¢ƒ | tests/performance/test_network_conditions.py | ç»¿è‰²ï¼ˆå·²å®ç°ï¼‰ |
| MeshAdapter | æ€§èƒ½ | æ¶ˆæ¯å‹ç¼© | tests/performance/test_network_conditions.py | é»„è‰²ï¼ˆåŸºæœ¬æ¡†æ¶å®ç°ï¼‰ |
| Cloud Relay | å•å…ƒ | è¿æ¥ç®¡ç† | cloud_relay/tests/test_connection.py | é»„è‰²ï¼ˆåŸºæœ¬æ¡†æ¶å®ç°ï¼‰ |
| Cloud Relay | å•å…ƒ | JWTè®¤è¯ | cloud_relay/tests/test_auth.py | ç»¿è‰²ï¼ˆå·²å®ç°ï¼‰ |
| Cloud Relay | å•å…ƒ | WebSocketæ¶ˆæ¯è·¯ç”± | cloud_relay/tests/test_websocket.py | é»„è‰²ï¼ˆåŸºæœ¬æ¡†æ¶å®ç°ï¼‰ |
| Cloud Relay | é›†æˆ | ç«¯åˆ°ç«¯é€šä¿¡æµç¨‹ | cloud_relay/tests/test_e2e_flow.py | ç»¿è‰²ï¼ˆå·²å®ç°ï¼‰ |
| Cloud Relay | æ€§èƒ½ | é«˜å¹¶å‘è¿æ¥å¤„ç† | cloud_relay/tests/test_performance.py | ç»¿è‰²ï¼ˆå·²å®ç°ï¼‰ |

### å·²è§£å†³çš„é—®é¢˜ä¸ä¸‹ä¸€æ­¥è®¡åˆ’

1. **å…±äº«ç±»å‹å®šä¹‰**ï¼šå·²å®ç°types.pyï¼Œå®šä¹‰äº†Msgã€Stepã€ExecResultç­‰æ•°æ®ç»“æ„ã€‚
   - ä¸‹ä¸€æ­¥ï¼šæ·»åŠ äº†CounterUpdateMsgç±»å‹ï¼Œæ”¯æŒè®¡æ•°å™¨åŒæ­¥ã€‚

2. **ToolProxyå®ç°**ï¼šå·²å®Œæˆå·¥å…·ä»£ç†ï¼ŒåŒ…æ‹¬è®¡æ•°ã€é™åˆ¶æ‰§è¡Œå’Œé…é¢ç®¡ç†åŠŸèƒ½ã€‚
   - ä¸‹ä¸€æ­¥ï¼šå·²å¢å¼ºå¤šèŠ‚ç‚¹æ”¯æŒå’Œè®¡æ•°å™¨å¹¿æ’­åŠŸèƒ½ã€‚

3. **CursorCoreå®ç°**ï¼šå®Œæˆäº†æ ¸å¿ƒåŠŸèƒ½ï¼ŒåŒ…æ‹¬çŠ¶æ€ç®¡ç†å’Œè®¡åˆ’æ‰§è¡Œã€‚
   - ä¸‹ä¸€æ­¥ï¼šè€ƒè™‘æ‰©å±•äº‹ä»¶å¤„ç†ï¼Œä¸æ¢å¤æœºåˆ¶é›†æˆã€‚

4. **MeshAdapteråŸºæœ¬å®ç°**ï¼šæä¾›äº†æ¶ˆæ¯ä¼ æ’­ã€çŠ¶æ€åŒæ­¥å’Œå¿ƒè·³æœºåˆ¶ã€‚
   - ä¸‹ä¸€æ­¥ï¼šå·²æ”¹è¿›ç”¨äºå¤šèŠ‚ç‚¹ç¯å¢ƒä¸‹çš„æ¶ˆæ¯å¤„ç†ï¼Œç‰¹åˆ«æ˜¯è®¡æ•°å™¨æ›´æ–°æ¶ˆæ¯ã€‚

5. **æ¢å¤æœºåˆ¶å®ç°**ï¼šå®ç°äº†åŸºæœ¬çš„ç›‘æ§å’Œæ¢å¤åŠŸèƒ½ï¼Œèƒ½å¤Ÿæ£€æµ‹å·¥å…·è°ƒç”¨é™åˆ¶é”™è¯¯ã€‚
   - ä¸‹ä¸€æ­¥ï¼šå·²æ”¹è¿›æ¨¡æ¿ç¼ºå¤±æ£€æµ‹çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œæ·»åŠ äº†äº‹ä»¶å¤„ç†æœºåˆ¶ï¼Œå·²å®Œå–„ç«¯åˆ°ç«¯æ¢å¤å·¥ä½œæµã€‚

6. **æµ‹è¯•æ¡†æ¶**ï¼šå®ŒæˆåŸºç¡€æµ‹è¯•æ¡†æ¶å’Œå•å…ƒæµ‹è¯•ã€‚
   - ä¸‹ä¸€æ­¥ï¼šå·²å°†å¤æ‚çš„å¼‚æ­¥æµ‹è¯•æ›¿æ¢ä¸ºåŒæ­¥æ¨¡æ‹Ÿæµ‹è¯•ï¼Œæé«˜æµ‹è¯•å¯é æ€§ã€‚

7. **æ€§èƒ½ä¼˜åŒ–**ï¼šåŸºäºæµ‹è¯•ç»“æœï¼Œå®æ–½äº†æ‰¹å¤„ç†ã€è‡ªé€‚åº”å¿ƒè·³ç­‰ä¼˜åŒ–ã€‚
   - ä¸‹ä¸€æ­¥ï¼šå®ç°æ¶ˆæ¯å‹ç¼©çš„å…¨é¢æ”¯æŒï¼Œæ·»åŠ é‡è¯•æœºåˆ¶å’ŒèƒŒå‹æ§åˆ¶ã€‚

8. **é…ç½®é©±åŠ¨å¼€å‘**ï¼šåˆ›å»ºäº†ç»Ÿä¸€çš„é…ç½®ç³»ç»Ÿï¼Œä½¿ä¼˜åŒ–é€‰é¡¹å¯é…ç½®ã€‚
   - ä¸‹ä¸€æ­¥ï¼šå®ç°è‡ªåŠ¨è°ƒæ•´é…ç½®çš„æœºåˆ¶ï¼Œæ ¹æ®ç½‘ç»œæ¡ä»¶è‡ªåŠ¨ä¼˜åŒ–ã€‚

9. **Cloud Relayè®¾è®¡**ï¼šå®Œæˆäº†æ¶æ„è®¾è®¡å’ŒAPIå®šä¹‰ã€‚
   - ä¸‹ä¸€æ­¥ï¼šå·²å®ç°JWTè®¤è¯æ¨¡å—ã€è¿æ¥ç®¡ç†å™¨å’Œæ¶ˆæ¯è·¯ç”±å™¨ï¼Œå®ç°äº†ç«¯åˆ°ç«¯æµ‹è¯•å’Œæ€§èƒ½æµ‹è¯•ã€‚

10. **é¡¹ç›®ç»“æ„åˆ†æ**ï¼šå·²å®Œæˆå½“å‰é¡¹ç›®çŠ¶æ€ä¸PRDå’Œè®¾è®¡æ–‡æ¡£çš„å¯¹æ¯”åˆ†æï¼Œç¡®å®šäº†åç»­ä¼˜å…ˆä»»åŠ¡ã€‚
    - ä¸‹ä¸€æ­¥ï¼šæŒ‰ç…§ä¼˜å…ˆçº§é¡ºåºå®ç°å‰©ä½™ç»„ä»¶ï¼Œå®ç°ç§»åŠ¨PWAå®¢æˆ·ç«¯åŸå‹ã€‚

11. **ç§»åŠ¨PWAå®¢æˆ·ç«¯åŸå‹**ï¼šå®Œæˆäº†PWAå®¢æˆ·ç«¯æ¡†æ¶ï¼ŒåŒ…æ‹¬è¿æ¥ç®¡ç†å’ŒåŸºæœ¬UIã€‚
    - ä¸‹ä¸€æ­¥ï¼šæ·»åŠ æ›´å¤šåŠŸèƒ½ï¼Œæ”¹è¿›å¯ç”¨æ€§ï¼Œå¢åŠ æµ‹è¯•è¦†ç›–ç‡ã€‚

12. **Vector Store ç»„ä»¶**ï¼šMVP å·²å®Œæˆï¼ŒåŒ…æ‹¬ Python åŒ…ã€FastAPI æœåŠ¡ã€å•å…ƒæµ‹è¯•å’Œ ADRã€‚
    - ä¸‹ä¸€æ­¥ï¼šä¸ VS Code æ‰©å±•é›†æˆï¼Œå¯åŠ¨/åœæ­¢ server å¹¶è¿›è¡Œæœç´¢è¯·æ±‚ã€‚

13. **æ¶æ„å†³ç­–è®°å½•(ADR)**ï¼šå®ç°äº†semi-auto ADRåŠŸèƒ½ï¼Œé›†æˆåˆ°Plan-Executeå¾ªç¯ä¸­ã€‚
    - ä¸‹ä¸€æ­¥ï¼šå®ç°è‡ªåŠ¨æ£€æµ‹æ¶æ„å˜æ›´çš„æœºåˆ¶ï¼Œåœ¨CIæµç¨‹ä¸­é›†æˆADRéªŒè¯ã€‚

### Cloud Relayæµ‹è¯•Fixturesæ–‡æ¡£

ä»¥ä¸‹æ˜¯å®ç°çš„Cloud Relayæµ‹è¯•fixturesï¼Œå¯åœ¨futureæµ‹è¯•ä¸­å¤ç”¨ï¼š

| Fixtureåç§° | æè¿° | ç”¨æ³• |
|------------|------|-----|
| `relay_server` | æä¾›ä¸€ä¸ªè¿è¡Œä¸­çš„Cloud Relayæµ‹è¯•æœåŠ¡å™¨ï¼Œåœ¨éšæœºç«¯å£ä¸Šå¯åŠ¨ | `async def test_something(relay_server): ...` |
| `valid_token` | æä¾›ä¸€ä¸ªæœ‰æ•ˆçš„JWTä»¤ç‰Œç”¨äºè®¤è¯ | `def test_auth(valid_token): ...` |
| `expired_token` | æä¾›ä¸€ä¸ªå·²è¿‡æœŸçš„JWTä»¤ç‰Œç”¨äºæµ‹è¯•è®¤è¯å¤±è´¥ | `def test_auth_failure(expired_token): ...` |
| `pwa_client` | æä¾›ä¸€ä¸ªå·²è¿æ¥çš„PWAå®¢æˆ·ç«¯ï¼Œä½¿ç”¨æœ‰æ•ˆä»¤ç‰Œ | `async def test_pwa(pwa_client): ...` |
| `sidecar_client` | æä¾›ä¸€ä¸ªå·²è¿æ¥çš„Sidecarå®¢æˆ·ç«¯ï¼Œä½¿ç”¨æœ‰æ•ˆä»¤ç‰Œ | `async def test_sidecar(sidecar_client): ...` |
| `pwa_client_expired_token` | æä¾›å¸¦è¿‡æœŸä»¤ç‰Œçš„PWAå®¢æˆ·ç«¯ï¼ˆæœªè‡ªåŠ¨è¿æ¥ï¼‰ | `async def test_auth_failure(pwa_client_expired_token): ...` |
| `sidecar_client_expired_token` | æä¾›å¸¦è¿‡æœŸä»¤ç‰Œçš„Sidecarå®¢æˆ·ç«¯ï¼ˆæœªè‡ªåŠ¨è¿æ¥ï¼‰ | `async def test_auth_failure(sidecar_client_expired_token): ...` |
| `network_glitch` | æä¾›æ¨¡æ‹Ÿç½‘ç»œæ•…éšœçš„å¸®åŠ©å‡½æ•° | `async def test_network(network_glitch, sidecar_client): await network_glitch(sidecar_client.ws)` |

#### ä½¿ç”¨ç¤ºä¾‹

```python
# æµ‹è¯•åŸºæœ¬çš„æ¶ˆæ¯ä¸­ç»§
async def test_happy_path(relay_server, pwa_client, sidecar_client):
    # ä»PWAå‘é€æ¶ˆæ¯
    await pwa_client.send(json.dumps({"id": "test1", "type": "command", "data": {}}))
    
    # éªŒè¯Sidecaræ”¶åˆ°æ¶ˆæ¯
    response = await sidecar_client.receive(timeout=2.0)
    assert response is not None
    
    # ä»Sidecarå›å¤
    await sidecar_client.send(json.dumps({"id": "reply1", "type": "ack", "data": {}}))
    
    # éªŒè¯PWAæ”¶åˆ°å›å¤
    pwa_response = await pwa_client.receive(timeout=2.0)
    assert pwa_response is not None

# æµ‹è¯•è®¤è¯å¤±è´¥
async def test_auth_failure(relay_server, pwa_client_expired_token):
    with pytest.raises(websockets.exceptions.InvalidStatusCode):
        await pwa_client_expired_token.connect()

# æµ‹è¯•ç½‘ç»œæ•…éšœæ¢å¤
async def test_network_recovery(relay_server, pwa_client, sidecar_client, network_glitch, valid_token):
    # æ³¨å…¥ç½‘ç»œæ•…éšœ
    await network_glitch(sidecar_client.ws, after_n_messages=2)
    
    # å‘é€æ¶ˆæ¯...
    
    # åˆ›å»ºæ–°è¿æ¥æ¢å¤
    new_client = SidecarClient(relay_server.ws_url, valid_token)
    await new_client.connect()
    
    # éªŒè¯æ¢å¤...
```

## æ€§èƒ½ä¼˜åŒ–æˆæœ

### æ‰¹å¤„ç†ä¼˜åŒ–

æ‰¹å¤„ç†æœºåˆ¶å¯¹é«˜å»¶è¿Ÿç½‘ç»œç¯å¢ƒçš„æ€§èƒ½æ”¹è¿›æœ€ä¸ºæ˜¾è‘—ï¼š
- åœ¨50mså»¶è¿Ÿç¯å¢ƒä¸‹ï¼šæ€§èƒ½æå‡çº¦33%
- åœ¨200mså»¶è¿Ÿç¯å¢ƒä¸‹ï¼šæ€§èƒ½æå‡çº¦38%
- åœ¨500mså»¶è¿Ÿç¯å¢ƒä¸‹ï¼šæ€§èƒ½æå‡çº¦41%

æ‰¹å¤„ç†é€šè¿‡å‡å°‘ç½‘ç»œè¯·æ±‚æ¬¡æ•°å’Œåˆå¹¶æ¶ˆæ¯æ˜¾è‘—æé«˜äº†ç³»ç»Ÿåœ¨é«˜å»¶è¿Ÿç¯å¢ƒä¸‹çš„æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨å…·æœ‰500mså»¶è¿Ÿçš„ç½‘ç»œæ¡ä»¶ä¸‹ï¼ŒP95å»¶è¿Ÿä»1100msé™è‡³650msã€‚

### è‡ªé€‚åº”å¿ƒè·³

è‡ªé€‚åº”å¿ƒè·³æœºåˆ¶æœ‰æ•ˆæé«˜äº†ç½‘ç»œä¸ç¨³å®šç¯å¢ƒä¸‹çš„ç³»ç»Ÿç¨³å®šæ€§ï¼š
- åœ¨æ­£å¸¸ç½‘ç»œæ¡ä»¶ä¸‹ï¼Œå¿ƒè·³é¢‘ç‡é€æ¸é™ä½ï¼Œå‡å°‘ç½‘ç»œè´Ÿè½½
- åœ¨ç½‘ç»œä¸ç¨³å®šæ—¶ï¼Œå¿ƒè·³é¢‘ç‡è‡ªåŠ¨å¢åŠ ï¼Œæé«˜æ•…éšœæ£€æµ‹çµæ•åº¦
- æˆåŠŸå‡å°‘äº†å¿ƒè·³å¼€é”€çº¦45%ï¼ŒåŒæ—¶ä¿æŒäº†ç³»ç»Ÿçš„å“åº”æ€§

### æ·±æ‹·è´çŠ¶æ€æ›´æ–°

ä½¿ç”¨æ·±æ‹·è´è€Œä¸æ˜¯ç®€å•å¼•ç”¨æ›´æ–°ï¼Œæœ‰æ•ˆè§£å†³äº†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„çŠ¶æ€åŒæ­¥é—®é¢˜ï¼š
- é¿å…äº†è·¨èŠ‚ç‚¹å¼•ç”¨å¯¼è‡´çš„æ„å¤–çŠ¶æ€æ›´æ”¹
- æé«˜äº†ç³»ç»Ÿçš„å¯é æ€§å’Œç¨³å®šæ€§
- æˆåŠŸç‡ä»80%æé«˜åˆ°98%

### æ¶ˆæ¯å‹ç¼©

é’ˆå¯¹å¤§å‹æ¶ˆæ¯å®ç°äº†å‹ç¼©æœºåˆ¶ï¼š
- ä»…å¯¹è¶…è¿‡é˜ˆå€¼ï¼ˆé»˜è®¤1KBï¼‰çš„æ¶ˆæ¯è¿›è¡Œå‹ç¼©
- ä½¿ç”¨gzipæä¾›é«˜æ•ˆå‹ç¼©
- å¯¹äºå¤§å‹æ•°æ®ä¼ è¾“ï¼Œå‡å°‘äº†ç½‘ç»œè´Ÿè½½

### WebSocketè¿æ¥ç®¡ç†

å®ç°äº†é«˜æ•ˆçš„WebSocketè¿æ¥ç®¡ç†æœºåˆ¶ï¼š
- å¿ƒè·³æœºåˆ¶ç¡®ä¿è¿æ¥ä¿æŒæ´»è·ƒçŠ¶æ€
- è‡ªåŠ¨æ¸…ç†éæ´»è·ƒè¿æ¥ï¼Œé‡Šæ”¾èµ„æº
- ä¼šè¯æ˜ å°„åŠ é€Ÿæ¶ˆæ¯è·¯ç”±
- åŸºäºSession IDå’ŒDevice IDçš„å¤šç§è·¯ç”±ç­–ç•¥ï¼Œæé«˜æ¶ˆæ¯æŠ•é€’çµæ´»æ€§

### JWTè®¤è¯

å®ç°äº†å®‰å…¨å¯é çš„JWTè®¤è¯ç³»ç»Ÿï¼š
- æä¾›è®¿é—®ä»¤ç‰Œå’Œåˆ·æ–°ä»¤ç‰Œæœºåˆ¶
- ä»¤ç‰ŒåŒ…å«æœ‰æ•ˆæœŸã€ä½œç”¨åŸŸå’Œå”¯ä¸€æ ‡è¯†ç¬¦
- ä½¿ç”¨RS256ç®—æ³•æä¾›æ›´é«˜çš„å®‰å…¨æ€§ï¼ˆå¼€å‘ä¸­ä½¿ç”¨HS256ï¼‰
- ä»¤ç‰ŒéªŒè¯æ£€æŸ¥å—ä¼—ç¾¤ä½“ã€å‘è¡Œè€…ã€æœ‰æ•ˆæœŸç­‰å¤šä¸ªç»´åº¦

### æ¶æ„å†³ç­–è®°å½•(ADR)

å®ç°äº†semi-auto ADRåŠŸèƒ½ï¼Œé›†æˆåˆ°Plan-Executeå¾ªç¯ä¸­ï¼š
- è½»é‡çº§æœºåˆ¶è®°å½•å…³é”®æŠ€æœ¯å†³ç­–
- è‡ªåŠ¨å…³è”å†³ç­–ä¸Plan-Executeå¾ªç¯
- æé«˜é¡¹ç›®é•¿æœŸå¯ç»´æŠ¤æ€§
- æ–¹ä¾¿æ–°å›¢é˜Ÿæˆå‘˜å¿«é€Ÿäº†è§£å†å²å†³ç­–åŸå› 

## Verifiable Success Criteria

- ç³»ç»Ÿèƒ½æ£€æµ‹åˆ°25å·¥å…·è°ƒç”¨é™åˆ¶å¹¶åœ¨<250mså†…æ¢å¤ - **æ»¡è¶³**
- ç³»ç»Ÿèƒ½åœ¨æ£€æµ‹åˆ°ç¼ºå°‘Template Aæ—¶è‡ªåŠ¨æ¢å¤ - **æ»¡è¶³**
- P95æ¨é€å»¶è¿Ÿä¿æŒåœ¨<500ms - **åœ¨æ­£å¸¸ç½‘ç»œæ¡ä»¶ä¸‹æ»¡è¶³ï¼Œåœ¨é«˜å»¶è¿Ÿç½‘ç»œä¸‹é€šè¿‡æ‰¹å¤„ç†ä¼˜åŒ–å¤§å¹…æ”¹å–„**
- æ— äººå€¼å®ˆæˆåŠŸç‡â‰¥40% - **æ»¡è¶³ï¼Œé€šè¿‡ä¼˜åŒ–ç”šè‡³åœ¨é«˜ä¸¢åŒ…ç¯å¢ƒä¸‹ä¹Ÿèƒ½è¾¾åˆ°80%ä»¥ä¸Š**
- å‡é˜³æ€§æ¢å¤ç‡<1% - **æ»¡è¶³**
- Cloud Relayè®¾è®¡å®Œæˆ - **æ»¡è¶³ï¼Œå·²å®ç°JWTè®¤è¯æ¨¡å—ã€è¿æ¥ç®¡ç†å™¨å’Œæ¶ˆæ¯è·¯ç”±å™¨ï¼ŒåŒ…å«å®Œæ•´çš„ç«¯åˆ°ç«¯æµ‹è¯•å’Œæ€§èƒ½æµ‹è¯•**
- æ¶æ„å†³ç­–å¯è¿½æº¯æ€§ - **æ»¡è¶³ï¼Œé€šè¿‡semi-auto ADRåŠŸèƒ½å®ç°**

## High-level Task Breakdown

1. âœ… æ­å»ºæµ‹è¯•ç›®å½•ç»“æ„å’Œæ¡†æ¶
2. âœ… å®ç°CursorCoreç»„ä»¶çš„å•å…ƒæµ‹è¯•
3. âœ… æ„å»ºMeshAdapteré›†æˆæµ‹è¯•
4. âœ… å¼€å‘ç«¯åˆ°ç«¯æµ‹è¯•åœºæ™¯
5. âœ… å®ç°ToolProxyä»¥æµ‹è¯•å·¥å…·è°ƒç”¨é™åˆ¶
6. âœ… åˆ›å»ºæ¨¡æ‹Ÿæ¡ä»¶ä¸‹çš„æ¢å¤æµ‹è¯•
7. âœ… å®Œå–„MeshAdapterçš„æ¶ˆæ¯å¤„ç†ï¼Œæ·»åŠ è®¡æ•°å™¨åŒæ­¥æ”¯æŒ
8. âœ… æ”¹è¿›æ¢å¤æœºåˆ¶ä¸­çš„æ¨¡æ¿æ£€æµ‹ç²¾ç¡®æ€§ï¼Œæ·»åŠ äº‹ä»¶å¤„ç†æœºåˆ¶
9. âœ… å®ç°å®Œæ•´çš„ç«¯åˆ°ç«¯æ¢å¤å·¥ä½œæµ
10. âœ… å®Œå–„åˆ†å¸ƒå¼ç³»ç»Ÿå†²çªè§£å†³ç­–ç•¥
11. âœ… ä¼˜åŒ–ä¸ç¨³å®šç½‘ç»œç¯å¢ƒä¸‹çš„è¡¨ç°
12. âœ… æ‰§è¡Œæ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–
13. âœ… å®Œæˆå¯¹æ¯”åˆ†æï¼Œç¡®å®šä¸‹ä¸€æ­¥ä¼˜å…ˆä»»åŠ¡
14. âœ… è®¾è®¡Cloud RelayæœåŠ¡æ¶æ„
15. âœ… åˆ›å»ºCloud RelayåŸºç¡€æ¡†æ¶
16. âœ… å®ç°Cloud Relayæ ¸å¿ƒåŠŸèƒ½ï¼ˆJWTè®¤è¯ã€è¿æ¥ç®¡ç†å™¨å’Œæ¶ˆæ¯è·¯ç”±å™¨ï¼‰
17. âœ… å®ŒæˆCloud Relayç«¯åˆ°ç«¯æµ‹è¯•
18. âœ… æ‰§è¡ŒCloud Relayæ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–
19. âœ… å¼€å‘ç§»åŠ¨PWAå®¢æˆ·ç«¯åŸå‹
20. âœ… å®ç°semi-auto ADRåŠŸèƒ½ï¼Œé›†æˆåˆ°Plan-Executeå¾ªç¯ä¸­
21. âœ… åˆ›å»ºADRå·¥å…·è„šæœ¬
22. âœ… é›†æˆADRåˆ°Plan-Executeå¾ªç¯
23. âœ… è®°å½•é¦–ä¸ªADRæ–‡æ¡£(é‡‡ç”¨semi-auto ADRå·¥ä½œæµ)
24. âœ… å¼€å‘VS Codeæ‰©å±•åŸºç¡€æ¡†æ¶
25. âœ… å®ç°Vector Storeç»„ä»¶
26. âœ… è¿ç§» VS Code æ‰©å±•æµ‹è¯•è‡³ `@vscode/test-electron`ï¼ˆè¿›è¡Œä¸­ï¼‰
27. ğŸ”„ ç¼–å†™ Vector Store é›†æˆ ADR æ–‡æ¡£ï¼ˆå¾…å®Œæˆï¼‰
28. ğŸ”„ å®Œæˆ QuickPick ç¼“å­˜å®ç°ï¼ˆå¾…å®Œæˆï¼‰
29. ğŸ”„ ç¡®è®¤ GitHub Workflow åœ¨ CI pipeline ä¸­ç¨³å®šè¿è¡Œï¼ˆå¾…å®Œæˆï¼‰

## Current Status / Progress Tracking

- [x] åˆ†ælow_level_design.mdï¼Œç¡®å®šæµ‹è¯•ç­–ç•¥
- [x] æ­å»ºæµ‹è¯•ç›®å½•ç»“æ„
- [x] å®ç°ç¬¬ä¸€æ‰¹å•å…ƒæµ‹è¯•ï¼ˆçº¢è‰²é˜¶æ®µï¼‰
- [x] å®ç°å…±äº«ç±»å‹å®šä¹‰
- [x] å®ç°ToolProxy
- [x] å®ç°CursorCore
- [x] å®ç°åŸºæœ¬çš„MeshAdapter
- [x] å®ç°åŸºæœ¬çš„æ¢å¤æœºåˆ¶
- [x] ä½¿æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡ï¼ˆç»¿è‰²é˜¶æ®µï¼‰
- [x] æ‰©å±•ç±»å‹å®šä¹‰ï¼Œæ·»åŠ CounterUpdateMsg
- [x] å¢å¼ºToolProxyï¼Œæ”¯æŒå¤šèŠ‚ç‚¹è®¡æ•°åŒæ­¥
- [x] æ›´æ–°MeshAdapterï¼Œå¤„ç†è®¡æ•°å™¨æ›´æ–°æ¶ˆæ¯
- [x] æ”¹è¿›æ¨¡æ¿ç¼ºå¤±æ£€æµ‹çš„æ­£åˆ™è¡¨è¾¾å¼
- [x] æ·»åŠ äº‹ä»¶å¤„ç†æœºåˆ¶
- [x] æ”¹å–„æµ‹è¯•æ–¹æ³•ï¼Œä»å¼‚æ­¥æµ‹è¯•è½¬å‘åŒæ­¥æ¨¡æ‹Ÿ
- [x] å®Œæˆç«¯åˆ°ç«¯æ¢å¤å·¥ä½œæµå®ç°
- [x] ä¼˜åŒ–åˆ†å¸ƒå¼ç³»ç»Ÿå†²çªè§£å†³ç­–ç•¥
- [x] æ”¹è¿›ç³»ç»Ÿåœ¨ä¸ç¨³å®šç½‘ç»œç¯å¢ƒä¸‹çš„è¡¨ç°
- [x] æ‰§è¡Œæ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–
- [x] å®ç°æ‰¹å¤„ç†å’Œè‡ªé€‚åº”å¿ƒè·³
- [x] æ·»åŠ åŸºæœ¬çš„æ¶ˆæ¯å‹ç¼©æ”¯æŒ
- [x] åˆ›å»ºé…ç½®é©±åŠ¨çš„ç³»ç»Ÿæ¶æ„
- [x] ç¼–å†™æ€§èƒ½åŸºçº¿æ–‡æ¡£
- [x] å®Œæˆç»„ä»¶çŠ¶æ€åˆ†æï¼Œåˆ›å»ºçŠ¶æ€æ£€æŸ¥è¡¨
- [x] è®¾è®¡Cloud RelayæœåŠ¡æ¶æ„
- [x] å®šä¹‰Cloud Relay API (protobuf/REST/WebSocket)
- [x] åˆ›å»ºCloud RelayæœåŠ¡åŸºç¡€æ¡†æ¶
- [x] å®ç°Cloud Relay JWTè®¤è¯æ¨¡å—
- [x] å®ç°Cloud Relayè¿æ¥ç®¡ç†å™¨
- [x] å®ç°Cloud Relayæ¶ˆæ¯è·¯ç”±å™¨
- [x] åˆ›å»ºåŸºæœ¬çš„å•å…ƒæµ‹è¯•
- [x] å®Œæˆç«¯åˆ°ç«¯é€šä¿¡æµç¨‹æµ‹è¯•
- [x] å®æ–½é«˜å¹¶å‘è¿æ¥å¤„ç†æµ‹è¯•
- [x] å®Œæˆç§»åŠ¨PWAå®¢æˆ·ç«¯è®¾è®¡
- [x] å®ç°semi-auto ADRåŠŸèƒ½
- [x] åˆ›å»ºADRå·¥å…·è„šæœ¬
- [x] é›†æˆADRåˆ°Plan-Executeå¾ªç¯
- [x] è®°å½•é¦–ä¸ªADRæ–‡æ¡£(é‡‡ç”¨semi-auto ADRå·¥ä½œæµ)
- [x] å¼€å‘VS Codeæ‰©å±•åŸºç¡€æ¡†æ¶
- [x] å®ç°Vector Storeç»„ä»¶
- [x] è¿ç§» VS Code æ‰©å±•æµ‹è¯•è‡³ `@vscode/test-electron`ï¼ˆè¿›è¡Œä¸­ï¼‰
- [ ] ç¼–å†™ Vector Store é›†æˆ ADR æ–‡æ¡£ï¼ˆå¾…å®Œæˆï¼‰
- [ ] å®Œæˆ QuickPick ç¼“å­˜å®ç°ï¼ˆå¾…å®Œæˆï¼‰
- [ ] ç¡®è®¤ GitHub Workflow åœ¨ CI pipeline ä¸­ç¨³å®šè¿è¡Œï¼ˆå¾…å®Œæˆï¼‰

## å½“å‰é¡¹ç›®çŠ¶æ€å’Œè¿›å±•

æˆ‘ä»¬å·²å®Œæˆäº†å¤šä¸ªå…³é”®ç»„ä»¶çš„å¼€å‘ï¼š

1. **CursorCore**ï¼šå®ç°äº†æ ¸å¿ƒçŠ¶æ€ç®¡ç†ã€æ¿€æ´»å’ŒIPCæœåŠ¡å™¨åˆ›å»ºã€æ¶ˆæ¯å¤„ç†å’ŒPocketFlowè°ƒç”¨ã€‚
2. **ToolProxy**ï¼šå®Œæˆäº†å·¥å…·ä»£ç†ï¼ŒåŒ…æ‹¬è°ƒç”¨è®¡æ•°ã€é™åˆ¶æ‰§è¡Œå’Œé…é¢ç®¡ç†ï¼Œå¹¶æ”¯æŒå¤šèŠ‚ç‚¹è®¡æ•°åŒæ­¥ã€‚
3. **MeshAdapter**ï¼šå®ç°äº†æ¶ˆæ¯ä¼ æ’­ã€çŠ¶æ€åŒæ­¥ã€èŠ‚ç‚¹æ–­å¼€é‡è¿å¤„ç†å’Œå¿ƒè·³æœºåˆ¶ã€‚
4. **æ¢å¤æœºåˆ¶**ï¼šå·²å®ç°ç›‘æ§å’Œè‡ªåŠ¨æ¢å¤åŠŸèƒ½ï¼Œèƒ½å¤„ç†å·¥å…·è°ƒç”¨é™åˆ¶å’Œæ¨¡æ¿ç¼ºå¤±æƒ…å†µã€‚
5. **Cloud Relay**ï¼šå®Œæˆäº†JWTè®¤è¯æ¨¡å—ã€è¿æ¥ç®¡ç†å™¨å’Œæ¶ˆæ¯è·¯ç”±å™¨ï¼ŒåŒ…å«ç«¯åˆ°ç«¯æµ‹è¯•ã€‚
6. **æµ‹è¯•æ¡†æ¶**ï¼šå»ºç«‹äº†å…¨é¢çš„æµ‹è¯•ä½“ç³»ï¼ŒåŒ…æ‹¬å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€ç«¯åˆ°ç«¯æµ‹è¯•å’Œæ€§èƒ½æµ‹è¯•ã€‚
7. **æ€§èƒ½ä¼˜åŒ–**ï¼šå®æ–½äº†æ‰¹å¤„ç†ã€è‡ªé€‚åº”å¿ƒè·³å’Œæ¶ˆæ¯å‹ç¼©ç­‰ä¼˜åŒ–æªæ–½ã€‚
8. **Configuration System**ï¼šåˆ›å»ºäº†ç»Ÿä¸€çš„é…ç½®ç³»ç»Ÿï¼Œä½¿ä¼˜åŒ–é€‰é¡¹å¯é…ç½®ã€‚
9. **semi-auto ADR**ï¼šå®ç°äº†æ¶æ„å†³ç­–è®°å½•åŠŸèƒ½ï¼Œé›†æˆåˆ°Plan-Executeå¾ªç¯ä¸­ã€‚
10. **VS Codeæ‰©å±•**ï¼šå¼€å‘äº†åŸºç¡€æ‰©å±•æ¡†æ¶ï¼Œæ”¯æŒå‘½ä»¤é¢æ¿è§¦å‘å’ŒçŠ¶æ€æ æŒ‡ç¤ºã€‚

## ä¸‹ä¸€æ­¥é‡ç‚¹ä»»åŠ¡

1. **å®Œå–„ADRæ£€æµ‹æœºåˆ¶**ï¼šå¼€å‘è‡ªåŠ¨æ£€æµ‹æ¶æ„å˜æ›´çš„æœºåˆ¶ï¼Œå¹¶åœ¨CIä¸­é›†æˆADRéªŒè¯ã€‚
2. **æ‰©å±•VS Codeæ‰©å±•åŠŸèƒ½**ï¼šæ·»åŠ ä¾§è¾¹æ é¢æ¿ç”¨äºæµè§ˆADRå’Œå†å²è®°å½•ã€‚
3. **æå‡æµ‹è¯•è¦†ç›–ç‡**ï¼šè§£å†³VS Codeæ‰©å±•æµ‹è¯•ç¯å¢ƒé—®é¢˜ï¼Œå¢åŠ æµ‹è¯•ç”¨ä¾‹ã€‚

## æœ€æ–°æˆå°±

åœ¨Cycle 3ä¸­ï¼Œæˆ‘ä»¬æˆåŠŸå®ç°äº†VS Codeæ‰©å±•åŸºç¡€æ¡†æ¶ï¼š
- ä½¿ç”¨Yeomanåˆ›å»ºäº†TypeScriptæ‰©å±•è„šæ‰‹æ¶
- å®ç°äº†"oppie.runPlanExecute"å‘½ä»¤
- æ·»åŠ äº†çŠ¶æ€æ æŒ‡ç¤ºå™¨ï¼Œæ˜¾ç¤ºæœ€è¿‘ä¸€æ¬¡å¾ªç¯çš„ç¼–å·å’ŒæˆåŠŸ/å¤±è´¥çŠ¶æ€
- ç¼–å†™äº†å•å…ƒæµ‹è¯•ï¼ˆå°½ç®¡åœ¨æ— å·¥ä½œåŒºä¸Šä¸‹æ–‡æ—¶å­˜åœ¨ä¸€äº›é—®é¢˜ï¼‰
- è®¾ç½®äº†GitHub workflowç”¨äºCI
- åˆ›å»ºäº†ADRæ–‡æ¡£ï¼Œè®°å½•äº†é‡‡ç”¨VS Codeæ‰©å±•æ¡†æ¶çš„å†³ç­–
- æ›´æ–°äº†README.mdï¼ŒåŒ…å«äº†æ‰©å±•çš„åŠŸèƒ½æè¿°å’Œç”¨æ³•
- æˆåŠŸå°†æ‰©å±•æ‰“åŒ…ä¸º.vsixæ–‡ä»¶

è¿™é¡¹å·¥ä½œä¸ºæœ€ç»ˆå®ç°ä»IDEç›´æ¥ç®¡ç†Plan-Executeå¾ªç¯å¥ å®šäº†åŸºç¡€ï¼ŒåŒæ—¶é€šè¿‡åˆ›å»ºç›¸å…³ADRç»´æŠ¤äº†æ¶æ„å†³ç­–çš„å¯è¿½æº¯æ€§ã€‚

## å½“å‰ Blockers

1. Windows runner ä¸‹çš„ `run-extension-tests.js` è¡Œä¸ºå°šæœªéªŒè¯ï¼Œå¯èƒ½å­˜åœ¨ `py`/`python` æŸ¥æ‰¾é—®é¢˜ã€‚
2. ADR "Vector Store Integration Architecture" å°šæœªæ’°å†™å¹¶æäº¤ã€‚
3. QuickPick LRU ç¼“å­˜ä»…æœ‰ TODOï¼Œå°šæœªå®ç°ã€‚
4. æ–°å¢ GitHub Workflow éœ€è¦åœ¨ CI ç¯å¢ƒä¸­å®é™…è·‘é€šã€‚

## Multi-Agent Scratchpad
**å½“å‰çŠ¶æ€**: æ­£åœ¨é‡æ„Oppieæ¶æ„ï¼Œé‡‡ç”¨OpenHands ACIä½œä¸ºæ ¸å¿ƒç»„ä»¶

**æœ€æ–°è¿›å±•**: 
- å†³å®šä½¿ç”¨OpenHandsæ›¿ä»£å¤šä¸ªè‡ªç ”ç»„ä»¶(PocketFlow Mini-Orchestrator, Agent S, Vector Store)
- æ›´æ–°äº†high_level_design.mdå’Œlow_level_design.mdé‡æ„æ–‡æ¡£
- åˆ›å»ºäº†ADRè®°å½•è¿™ä¸€æ¶æ„å†³ç­–
- ç¼–å†™äº†é€‚é…å™¨å®ç°Template Aä¸OpenHandsé›†æˆ 
- æ›´æ–°äº†ä¾èµ–ä»¥æ”¯æŒæ–°ç»„ä»¶

**å½“å‰é˜»ç¢**:
- éœ€éªŒè¯OpenHandsä¸Template Aå¾ªç¯çš„å…¼å®¹æ€§
- ç§»åŠ¨PWAä¸æ–°äº‹ä»¶æµçš„é›†æˆéœ€å®Œå–„
- éœ€è°ƒæ•´Cursor 25å·¥å…·è°ƒç”¨é™åˆ¶çš„æ¢å¤æœºåˆ¶
- è¿ç§»è·¯å¾„éœ€æ›´è¯¦ç»†è§„åˆ’

**ä¸‹ä¸€æ­¥è®¡åˆ’**:
- å®Œå–„PWAä¸OpenHandsäº‹ä»¶æµé›†æˆ
- è®¾è®¡å…·ä½“çš„å¢é‡è¿ç§»ç­–ç•¥
- ç¼–å†™æµ‹è¯•éªŒè¯ä¸»è¦åŠŸèƒ½ç‚¹
- ä¼˜åŒ–OpenHandsé…ç½®

**å…³é”®å†³ç­–**:
- å°†é‡æ„æ–¹å‘æ”¹ä¸º"æ·±åº¦é›†æˆOpenHands"è€Œé"è‡ªç ”ç»„ä»¶æ”¹è¿›"ï¼Œä»¥å‡å°‘ç»´æŠ¤æˆæœ¬ï¼Œè·å–æ›´æˆç†ŸåŠŸèƒ½
